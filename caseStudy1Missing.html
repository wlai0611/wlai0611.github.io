<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Walter" />

<meta name="date" content="2020-01-11" />

<title>caseStudy1</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">caseStudy1</h1>
<h4 class="author">Walter</h4>
<h4 class="date">January 11, 2020</h4>

</div>


<p>Load Data and Libraries</p>
<pre class="r"><code>beer=read.csv(file.choose())
breweries=read.csv(file.choose())
cities=read.csv(file.choose())
library(dplyr)
library(grid)
library(ggplot2)
library(tidyr)
library(maps)
library(usmap)
library(stringr)
library(class)
library(caret)
library(Hmisc)
library(gridExtra)
library(naniar)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Merge Beer Data with Brewery Data</li>
</ol>
<pre class="r"><code>beerBrew=merge(beer,breweries,by.x=&quot;Brewery_id&quot;,by.y=&quot;Brew_ID&quot;)</code></pre>
<ol style="list-style-type: decimal">
<li>Number of Breweries Per State</li>
</ol>
<pre class="r"><code>stateCoords=us_map()
# Remove Leading Spaces from State Column of merged Beer Brew Data frame (prepare for join)
# Summarise Each State&#39;s Number of Breweries and Beers
stateBrewBeer= beerBrew %&gt;% mutate(State=gsub(&quot; &quot;,&quot;&quot;,State)) %&gt;% group_by(State) %&gt;% summarise(brews=length(unique(Brewery_id)),beers=n())

#Join Brewery Beer Data with a dataframe containing state coordinates and population
statePopBrBe = merge(statepop,stateBrewBeer,all.x=TRUE,by.y=&quot;State&quot;,by.x=&quot;abbr&quot;)
statePopBrBe=statePopBrBe %&gt;% mutate(brewCap=brews/pop_2015,beerCap=beers/pop_2015)

plot_usmap(data=statePopBrBe,values=&quot;brews&quot;,labels = TRUE)+scale_fill_continuous(name=&quot;Number Breweries&quot;)</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-3-1.png" width="672" /> 3. Address the missing values in each column.</p>
<pre class="r"><code># plot missing values in each column, rename some columns
gg_miss_var(beerBrew%&gt;%rename(Beer_Name=Name.x,Brewery_Name=Name.y,Brewery_ID=Brewery_id)
            %&gt;%select(IBU,ABV,Style,State,Ounces,City,Brewery_Name,Beer_Name,
                      Brewery_ID,Beer_ID))</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code># convert empty string Styles to NAs to more easily see missings in all columns
beerBrew$Style[which(beerBrew$Style==&quot;&quot;)]=NA
sapply(beerBrew, function(x) sum(is.na(x)))</code></pre>
<pre><code>## Brewery_id     Name.x    Beer_ID        ABV        IBU      Style     Ounces     Name.y       City 
##          0          0          0         62       1005          5          0          0          0 
##      State 
##          0</code></pre>
<p>4.Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.</p>
<pre class="r"><code>beerBrew %&gt;% group_by(State) %&gt;%
  filter(!is.na(ABV))%&gt;%
  summarise(ABV=median(ABV)) %&gt;%
   ggplot(aes(x=reorder(State,-ABV),ABV)) +
  geom_bar(stat=&quot;identity&quot;, position=&quot;dodge&quot;, color=&#39;skyblue&#39;,fill=&#39;steelblue&#39;) + 
 # scale_y_continuous(limits = c(0.5,0.07))+
  #coord_flip()+ 
  xlab(&quot;State&quot;) +  ylab(&quot;ABV&quot;) + ggtitle(&quot;Median ABV by State&quot;) </code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre class="r"><code> beerBrew %&gt;% group_by(State) %&gt;%
  filter(!is.na(IBU))%&gt;%
  summarise(IBU=median(IBU)) %&gt;%
   ggplot(aes(x=reorder(State,-IBU),IBU)) +
  geom_bar(stat=&quot;identity&quot;, position=&quot;dodge&quot;, color=&#39;skyblue&#39;,fill=&#39;steelblue&#39;) + 
  coord_flip()+ 
  xlab(&quot;State&quot;) +  ylab(&quot;IBU&quot;) + ggtitle(&quot;Median IBU by State&quot;)</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>(part 1) Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?</li>
</ol>
<pre class="r"><code>#find the single most ABV beer
beerBrew %&gt;% filter(!is.na(ABV)) %&gt;% mutate(maxABV=max(ABV)) %&gt;%
  filter(ABV==maxABV) %&gt;%select(State,Name.x,Name.y,ABV)</code></pre>
<pre><code>##   State                                               Name.x                  Name.y   ABV
## 1    CO Lee Hill Series Vol. 5 - Belgian Style Quadrupel Ale Upslope Brewing Company 0.128</code></pre>
<pre class="r"><code># 
#find the single most bitter beer
beerBrew %&gt;% filter(!is.na(IBU)) %&gt;% mutate(maxIBU=max(IBU)) %&gt;%
  filter(IBU==maxIBU)%&gt;%select(State,Name.x,Name.y,IBU)</code></pre>
<pre><code>##   State                    Name.x                  Name.y IBU
## 1    OR Bitter Bitch Imperial IPA Astoria Brewing Company 138</code></pre>
<p>6.Comment on the summary statistics and distribution of the ABV variable The ABV is mostly normally distributed with a noticeable right tail. The mean is Larger than the median.</p>
<pre class="r"><code>#Check for normality of ABV using qq plot and histogram
beerBrew %&gt;% filter(!is.na(ABV)) %&gt;% ggplot() +stat_qq(aes(sample=ABV)) </code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<pre class="r"><code>beerBrew %&gt;% filter(!is.na(ABV)) %&gt;% ggplot()+geom_histogram(aes(ABV))</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-7-2.png" width="672" /></p>
<pre class="r"><code>beerBrew %&gt;% filter(!is.na(ABV)) %&gt;% select(ABV)%&gt;%summary()</code></pre>
<pre><code>##       ABV         
##  Min.   :0.00100  
##  1st Qu.:0.05000  
##  Median :0.05600  
##  Mean   :0.05977  
##  3rd Qu.:0.06700  
##  Max.   :0.12800</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Group beer styles into larger style buckets</li>
</ol>
<pre class="r"><code>#Categorize the many styles into 5 groups


  beerBrew$StyleCat= case_when(
    grepl(&quot;(India Pale Ale|IPA)&quot;,beerBrew$Style) ~ &quot;IPA&quot;,
    grepl( &quot;Ale&quot;,beerBrew$Style) ~ &quot;Ale&quot;,
    grepl(&quot;Lager&quot;,beerBrew$Style)~&quot;Lager&quot;,
    grepl(&quot;Stout&quot;,beerBrew$Style)~&quot;Stout&quot;,
    TRUE~&quot;Other&quot;
  )</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot. Make your best judgment of a relationship and EXPLAIN your answer. There is a moderate positive correlation between ABV and IBU. The upward slope is evidence of a positive relationship. The points’ moderate to small deviations from the trendline is evidence of a moderate to weak relationship.</li>
</ol>
<pre class="r"><code>beerBrew %&gt;% filter(!is.na(ABV)&amp;!is.na(IBU))%&gt;%
  
ggplot(aes(ABV,IBU,color=StyleCat))+geom_point(position=position_jitter(width=0.01),alpha=0.5)+geom_smooth(method=&quot;lm&quot;,se=FALSE,size=2) +labs(title=&quot;Correlation between ABV and IBU&quot;) </code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>We address the feasability of using ABV and IBU to predict a Beer’s Style. We are creating a classifier object that will have an input of a list of ABV and IBU values. Its output will be a list of Beer Styles.</p>
<p>Prepare data set for KNN</p>
<pre class="r"><code># remove NAs in columns which will use for KNN
beerBrewClean=beerBrew %&gt;% filter(!is.na(ABV)&amp;!is.na(IBU)&amp;!is.na(StyleCat))</code></pre>
<p>We randomly divide the dataset of Beers into two parts. One to train the classifier function on. Another to test how well the classifier can classify Beer Styles.<br />
The Sensitivity represents the probability our classifier can classify an Ale when we present it with an Ale’s IBU and ABV Values. The Specificity represents the probability our classifier can classify an IPA when we present it with an IPA’s IBU and ABV values.</p>
<pre class="r"><code># Split percentage of train test 
splitPerc=0.7
#Response Variable of KNN
response=&quot;StyleCat&quot;
#data is just the merged Beer and Brewery dataframe without NAs and IPA,Ales only
data=beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;))
#column names of explanatory variables for KNN
explanatory=c(&quot;ABV&quot;,&quot;IBU&quot;)
iterations=100
#empty arrays to store Accuracy, Sensitivity and SPecificity of model performance
#with randomly shuffled train and tests
masterAcc=double(iterations)
masterSens=double(iterations)
masterSpec=double(iterations)


for( x in 1:iterations){
# remove NAs from necessary columns
  
# scale explanatories
data[,explanatory]=scale(data[,explanatory])
  
trainIndices = sample(1:dim(data)[1],round(splitPerc * dim(data)[1]))
train = data[trainIndices,]
test = data[-trainIndices,]
classifications=knn(train[,explanatory],test[,explanatory],train[,response],k=3)  

  CM = confusionMatrix(table(classifications,test[,response]))
  masterAcc[x] = CM$overall[1]
  masterSens[x]=CM$byClass[1]
  masterSpec[x]=CM$byClass[2]
  }
MeanAcc = mean(masterAcc)
MeanSens=mean(masterSens)
MeanSpec=mean(masterSpec)</code></pre>
<p>How do Ales and IPAs differ in terms of ABV and IBU? How much more alcoholic or bitter is one style over the other?</p>
<p>Visualize difference in IBU and ABV between Styles</p>
<pre class="r"><code>beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;)) %&gt;% select(Beer_ID,ABV,IBU,StyleCat)%&gt;%
  gather(&quot;Variable&quot;,&quot;Value&quot;,c(-StyleCat,-Beer_ID))%&gt;%
ggplot() + geom_boxplot(aes(StyleCat,Value)) + scale_x_discrete(name=&quot;Alcohol Style&quot;) +
   labs(title=&quot;ABV and IBU Differences By Style&quot;) + facet_grid(Variable~.,scales = &quot;free_y&quot;)</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code>beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;)) %&gt;% ggplot(aes(color=StyleCat,ABV,IBU)) + 
  geom_point()+labs(title=&quot;IBU/ABV Ratio for Each Beer By Style&quot;)</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Testing for significant differences in ABV and IBU between IPA and Ales Check the data to see if ABV and IBU form bell curves. Bell Curve Distributions allow us to generalize our conclusions to loarger populations.</p>
<pre class="r"><code># Assumptions  Central Limit Theorem can be invoked
normalityBeer= beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;)) %&gt;% ggplot() 
#+ stat_qq(aes(sample=log(ABV)))

 
qqABV= beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;)) %&gt;% ggplot() +stat_qq(aes(sample=log(ABV)))+ylab(&quot;Log(ABV)&quot;)+labs(title=&quot;Log ABV Normality Check&quot;)+
    theme(text = element_text(size=20))

beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;)) %&gt;% ggplot() + geom_histogram(aes(log(IBU)))+ labs(title=&quot;Distribution of Log IBU for Ales/ IPAs&quot;)</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>qqIBU=beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;)) %&gt;% ggplot() + 
  stat_qq(aes(sample=log(ABV)))+ylab(&quot;Log(IBU)&quot;)+labs(title=&quot;Log IBU Normality Check&quot;)+
    theme(text = element_text(size=20))

qqABV=ggplot_gtable(ggplot_build(qqABV))
qqIBU=ggplot_gtable(ggplot_build(qqIBU))
maxWidth = unit.pmax(qqABV$heights[2:3], qqIBU$heights[2:3])

qqABV$heights[2:3] &lt;- maxWidth
qqIBU$heights[2:3] &lt;- maxWidth

grid.arrange(qqABV, qqIBU, heights = c(2, 2)) </code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-14-2.png" width="672" /></p>
<pre class="r"><code>beerBrewClean %&gt;%  group_by(StyleCat) %&gt;% summarise(sd=sd(ABV),sdIBU=sd(IBU))</code></pre>
<pre><code>## # A tibble: 5 x 3
##   StyleCat      sd sdIBU
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1 Ale      0.0111   18.0
## 2 IPA      0.0122   19.5
## 3 Lager    0.00711  13.4
## 4 Other    0.0130   15.9
## 5 Stout    0.0186   24.1</code></pre>
<pre class="r"><code>histABV= normalityBeer + geom_histogram(aes(log(ABV)))
histIBU=normalityBeer + geom_histogram(aes(log(IBU)))
histABV=ggplot_gtable(ggplot_build(histABV))</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre class="r"><code>histIBU=ggplot_gtable(ggplot_build(histIBU))</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre class="r"><code>maxWidth = unit.pmax(histABV$heights[2:3], histIBU$heights[2:3])

histABV$heights[2:3] &lt;- maxWidth
histIBU$heights[2:3] &lt;- maxWidth

grid.arrange(histABV, histIBU, heights = c(2, 2),ncol=2)</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;)) %&gt;% 
  select(Beer_ID,ABV,IBU)%&gt;%
gather( &quot;Variable&quot;, &quot;Values&quot;, -Beer_ID)%&gt;%
  ggplot() + geom_histogram(aes(Values)) + facet_grid(~Variable,scales = &quot;free_x&quot;) +
    theme(text = element_text(size=20))</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<pre class="r"><code>ABUtest=t.test(log(ABV)~StyleCat,var.equal=TRUE,beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;) &amp;  !is.na(ABV)) %&gt;% mutate(ibuABV=IBU/ABV) )

ibuTest=t.test(log(IBU)~StyleCat,var.equal=TRUE,beerBrewClean %&gt;% filter(StyleCat %in% c(&quot;Ale&quot;,&quot;IPA&quot;) &amp;  !is.na(IBU)) %&gt;% mutate(ibuABV=IBU/ABV) )</code></pre>
<p>In terms of ABV, median of IPA compared to median of Ales is a ratio ranging between</p>
<pre class="r"><code>exp(ABUtest$conf.int)</code></pre>
<pre><code>## [1] 0.7976278 0.8361243
## attr(,&quot;conf.level&quot;)
## [1] 0.95</code></pre>
<p>In terms of IBU, median of IPA compared to median of Ales is a ratio ranging between</p>
<pre class="r"><code>exp(ibuTest$conf.int)</code></pre>
<pre><code>## [1] 0.4079911 0.4585913
## attr(,&quot;conf.level&quot;)
## [1] 0.95</code></pre>
<p>Test set is the records of missing IBUs Train set is the records that have IBU not missing</p>
<div id="identifying-the-missing-styles-in-underserved-cities" class="section level1">
<h1>Identifying the missing Styles in underserved cities</h1>
<p>1.Find the national percentages of each Style Category visually</p>
<pre class="r"><code>#national percentage of styles
beerBrew %&gt;% ggplot() + stat_summary(geom=&quot;bar&quot;,aes(StyleCat,Beer_ID),fun.y=function(x){
  length(unique(x))/length(unique(beerBrew$Beer_ID))
})</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-19-1.png" width="672" /> 2. Table Format of national percentages</p>
<pre class="r"><code>nationalPct=beerBrew %&gt;% group_by(StyleCat) %&gt;% summarise(pct=n()/with(beerBrew,length(unique(Beer_ID))))</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>CityData contains the population of 314 of AMerica’s Most populous cities.<br />
Add a column that contains the population of the city for each Beer’s Brewery.</li>
</ol>
<pre class="r"><code>#remove the leading space in all States of beerBrew
beerBrew$State = with(beerBrew, gsub(as.character(State),pattern=&quot; &quot;,replacement = &quot;&quot;))
beerBrew$City=as.character(beerBrew$City)
cities$City= with(cities,as.character(City))
cities$State=with(cities,as.character(State))

#change State abbreviation to full name
States=map_data(&quot;state&quot;)
lookup = data.frame(abb = state.abb, State = state.name)
lookup$abb=as.character(lookup$abb)
lookup$State=as.character(lookup$State)
lookup=rbind(lookup,c(&quot;DC&quot;,&quot;district of columbia&quot;))
# turn abbreviations to state names for beerBrew because cities has full names
beerBrew=merge(beerBrew,lookup,all.x=TRUE,by.x=&quot;State&quot;,by.y=&quot;abb&quot;)

#remove leading blanks in cities State field
cities$State = str_remove(cities$State,&quot;^\\s&quot;)

# FINALLY
beerBrewCities = left_join(beerBrew, cities, by=c(&quot;City&quot;=&quot;City&quot;,&quot;State.y&quot;=&quot;State&quot;))</code></pre>
<p>convert population data string to number</p>
<pre class="r"><code>beerBrewCities$X2018 = with(beerBrewCities,as.numeric(str_replace(as.character(X2018),&quot;,&quot;,&quot;&quot;)))</code></pre>
<pre><code>## Warning in eval(substitute(expr), data, enclos = parent.frame()): NAs introduced by coercion</code></pre>
<pre class="r"><code>beerBrewCities$X2010 = with(beerBrewCities,as.numeric(str_replace(as.character(X2010),&quot;,&quot;,&quot;&quot;)))</code></pre>
<pre><code>## Warning in eval(substitute(expr), data, enclos = parent.frame()): NAs introduced by coercion</code></pre>
<pre class="r"><code>#write.csv( beerBrewCities %&gt;% arrange(desc(X2018)) %&gt;% head(),&quot;BeerLeftCityState.csv&quot; )</code></pre>
</div>
<div id="which-cities-have-percentages-of-style-that-are-less-than-the-national-averages-percentage" class="section level1">
<h1>Which cities have percentages of Style that are less than the national average’s percentage?</h1>
<ol start="3" style="list-style-type: decimal">
<li>For the top 314 most populous cities, find the average percentage of each style and the standard deviation of the percentage of each style.</li>
</ol>
<pre class="r"><code>  stylePctByState=beerBrew %&gt;% group_by(State,City) %&gt;%
  #find the total number of beers for each city without aggregating
  mutate(nBeers=length(unique(Beer_ID))) %&gt;%
  ungroup()%&gt;%
  #find the total number of beers for each city,style combination
  group_by(State,City,StyleCat) %&gt;% summarise(nBeersPerStylePerCity=
                                                   length(unique(Beer_ID)),nBeers=
                                          mean(nBeers)) %&gt;%
  #divide the number of Lagers in Minneapolis by the number of beers in minneapolis
  mutate(stylePct=nBeersPerStylePerCity/nBeers)%&gt;% arrange(desc(stylePct)) %&gt;%
  ungroup()%&gt;%
  #find the average and standard deviation of all the cities&#39; percentages of Lager,Ale,etc.
  group_by(StyleCat) %&gt;%
  summarise(meanPct=mean(stylePct),sdPct=sd(stylePct))
stylePctByState</code></pre>
<pre><code>## # A tibble: 5 x 3
##   StyleCat meanPct sdPct
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1 Ale        0.522 0.248
## 2 IPA        0.374 0.226
## 3 Lager      0.351 0.333
## 4 Other      0.401 0.236
## 5 Stout      0.194 0.173</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>What are the national percentages and the variation of each style’s percentage by city?</li>
</ol>
<pre class="r"><code>stylePctByState %&gt;% ggplot() + geom_point(aes(StyleCat,meanPct),size=10)+geom_errorbar(aes(
  x=StyleCat,ymin= meanPct-sdPct,ymax=meanPct+sdPct
))</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-24-1.png" width="672" /> In order to compare each city’s style percentage to the national percentage for each style. We need to find the percentage of each style in each city.</p>
<pre class="r"><code>targetCities = beerBrewCities %&gt;% group_by(State,City) %&gt;%
  #find the number of breweries per capita to be used as measure of underserved cities
  mutate(brewPcap=length(unique(Brewery_id))/
                                                  mean(X2018),nBeers=length(unique(Beer_ID)),X2018=mean(X2018)) %&gt;%
  #find the number of beers in each city and the population in each city
  #arrange(desc(brewPcap)) %&gt;%
  ungroup() %&gt;%
  #find the number of beers for each particulr style in each city
  group_by(State,City,StyleCat) %&gt;% summarise(nBeersPerStylePerCity=
                                                   length(unique(Beer_ID)),nBeers=
                                          mean(nBeers),brewPcap=mean(brewPcap),X2018=mean(X2018)) %&gt;%
  mutate(stylePct=nBeersPerStylePerCity/nBeers) #%&gt;% ungroup() %&gt;%
  #top_n(10,brewPcap)
head(targetCities,10)</code></pre>
<pre><code>## # A tibble: 10 x 8
## # Groups:   State, City [4]
##    State City      StyleCat nBeersPerStylePerCity nBeers   brewPcap  X2018 stylePct
##    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;                    &lt;int&gt;  &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1 AK    Anchorage Ale                          7     15  0.0000137 291538    0.467
##  2 AK    Anchorage IPA                          5     15  0.0000137 291538    0.333
##  3 AK    Anchorage Other                        3     15  0.0000137 291538    0.2  
##  4 AK    Juneau    Ale                          1      2 NA             NA    0.5  
##  5 AK    Juneau    Other                        1      2 NA             NA    0.5  
##  6 AK    Soldotna  Ale                          3      4 NA             NA    0.75 
##  7 AK    Soldotna  IPA                          1      4 NA             NA    0.25 
##  8 AK    Talkeetna Ale                          2      4 NA             NA    0.5  
##  9 AK    Talkeetna IPA                          1      4 NA             NA    0.25 
## 10 AK    Talkeetna Stout                        1      4 NA             NA    0.25</code></pre>
<p>Cities that are missing a style do not have observations for that style. Add observations containing 0% for cities that have no beers for a certain style.</p>
<pre class="r"><code>#create a subset of the cities and style percentages data to test a function
# that will add observations containing 0% for cities that ar emissing styles
small = targetCities %&gt;% ungroup() %&gt;% top_n(10,brewPcap)



#juust right join the greenbay
small= small[small$City==&quot;Green Bay&quot;,]
missingStyle0 =  function(small,a)
  {
  #right join the complete list of styles to each city&#39;s data to create NAs for
  #missing styles
  smallCat= small %&gt;% merge(stylePctByState,all.y=TRUE)
  # find the rows that are missing and put 0% for the style percentage
  naIndices=which(is.na(smallCat$City))
  smallCat$stylePct[naIndices]=0
  # for the rest of the rows, copy the information from the non-NA rows
  smallCat$State[naIndices]=max(smallCat$State[-naIndices])
  smallCat$City[naIndices]=max(smallCat$City[-naIndices])
  smallCat$brewPcap[naIndices]=max(smallCat$brewPcap[-naIndices])
  smallCat$X2018[naIndices]=max(smallCat$X2018[-naIndices])
  return(smallCat)
}
missingStyle0(small)</code></pre>
<pre><code>##   StyleCat State      City nBeersPerStylePerCity nBeers     brewPcap  X2018 stylePct   meanPct     sdPct
## 1      Ale    WI Green Bay                     1      2 1.906959e-05 104879      0.5 0.5219114 0.2484043
## 2      IPA    WI Green Bay                     1      2 1.906959e-05 104879      0.5 0.3739356 0.2257477
## 3    Lager    WI Green Bay                    NA     NA 1.906959e-05 104879      0.0 0.3507032 0.3334354
## 4    Other    WI Green Bay                    NA     NA 1.906959e-05 104879      0.0 0.4007520 0.2357859
## 5    Stout    WI Green Bay                    NA     NA 1.906959e-05 104879      0.0 0.1938534 0.1731264</code></pre>
<pre class="r"><code>test=targetCities %&gt;% ungroup() %&gt;% top_n(10,brewPcap)
# apply this function tothe test dataframe, check to see if missing styles has 0s as style%
test %&gt;% group_by(State,City) %&gt;% do(missingStyle0(.,1))</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## # A tibble: 15 x 10
## # Groups:   State, City [3]
##    StyleCat State City      nBeersPerStylePerCity nBeers  brewPcap  X2018 stylePct meanPct sdPct
##    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;                     &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 Ale      CA    Temecula                      2      5 0.0000174 114742   0.4      0.522 0.248
##  2 IPA      CA    Temecula                      1      5 0.0000174 114742   0.2      0.374 0.226
##  3 Lager    CA    Temecula                     NA     NA 0.0000174 114742   0        0.351 0.333
##  4 Other    CA    Temecula                      2      5 0.0000174 114742   0.4      0.401 0.236
##  5 Stout    CA    Temecula                     NA     NA 0.0000174 114742   0        0.194 0.173
##  6 Ale      CO    Boulder                      17     41 0.0000838 107353   0.415    0.522 0.248
##  7 IPA      CO    Boulder                       8     41 0.0000838 107353   0.195    0.374 0.226
##  8 Lager    CO    Boulder                       2     41 0.0000838 107353   0.0488   0.351 0.333
##  9 Other    CO    Boulder                      11     41 0.0000838 107353   0.268    0.401 0.236
## 10 Stout    CO    Boulder                       3     41 0.0000838 107353   0.0732   0.194 0.173
## 11 Ale      WI    Green Bay                     1      2 0.0000191 104879   0.5      0.522 0.248
## 12 IPA      WI    Green Bay                     1      2 0.0000191 104879   0.5      0.374 0.226
## 13 Lager    WI    Green Bay                    NA     NA 0.0000191 104879   0        0.351 0.333
## 14 Other    WI    Green Bay                    NA     NA 0.0000191 104879   0        0.401 0.236
## 15 Stout    WI    Green Bay                    NA     NA 0.0000191 104879   0        0.194 0.173</code></pre>
<pre class="r"><code># all other NAs will match the previous column data</code></pre>
<p>For states with missing styleCats add rows with the missing style and 0% as the style percent</p>
<pre class="r"><code>targets0= targetCities %&gt;% group_by(State,City) %&gt;% do(missingStyle0(.,1))</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$State[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$City[-naIndices]): no non-missing arguments, returning NA</code></pre>
<pre><code>## Warning in max(smallCat$brewPcap[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre><code>## Warning in max(smallCat$X2018[-naIndices]): no non-missing arguments to max; returning -Inf</code></pre>
<pre class="r"><code>#check all cities have 5 styles regardless of if they made any beer with that style
with(targetCities,length(unique(City)))*5</code></pre>
<pre><code>## [1] 1920</code></pre>
<pre class="r"><code>head(targets0)</code></pre>
<pre><code>## # A tibble: 6 x 10
## # Groups:   State, City [2]
##   StyleCat State City      nBeersPerStylePerCity nBeers   brewPcap  X2018 stylePct meanPct sdPct
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;                     &lt;int&gt;  &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 Ale      AK    Anchorage                     7     15  0.0000137 291538    0.467   0.522 0.248
## 2 IPA      AK    Anchorage                     5     15  0.0000137 291538    0.333   0.374 0.226
## 3 Lager    AK    Anchorage                    NA     NA  0.0000137 291538    0       0.351 0.333
## 4 Other    AK    Anchorage                     3     15  0.0000137 291538    0.2     0.401 0.236
## 5 Stout    AK    Anchorage                    NA     NA  0.0000137 291538    0       0.194 0.173
## 6 Ale      AK    Juneau                        1      2 NA             NA    0.5     0.522 0.248</code></pre>
<p>Find the underserved cities which are defined as cities with the lowest breweries per capita.</p>
<pre class="r"><code>filterCity=targets0 %&gt;%
  ungroup()%&gt;%
  top_n(-25,brewPcap)
filterCity</code></pre>
<pre><code>## # A tibble: 25 x 10
##    StyleCat State City       nBeersPerStylePerCity nBeers   brewPcap  X2018 stylePct meanPct sdPct
##    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;                      &lt;int&gt;  &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1 Ale      CA    Sacramento                     4      5 0.00000197 508529    0.8     0.522 0.248
##  2 IPA      CA    Sacramento                    NA     NA 0.00000197 508529    0       0.374 0.226
##  3 Lager    CA    Sacramento                     1      5 0.00000197 508529    0.2     0.351 0.333
##  4 Other    CA    Sacramento                    NA     NA 0.00000197 508529    0       0.401 0.236
##  5 Stout    CA    Sacramento                    NA     NA 0.00000197 508529    0       0.194 0.173
##  6 Ale      MI    Detroit                        1      6 0.00000149 672662    0.167   0.522 0.248
##  7 IPA      MI    Detroit                        2      6 0.00000149 672662    0.333   0.374 0.226
##  8 Lager    MI    Detroit                        1      6 0.00000149 672662    0.167   0.351 0.333
##  9 Other    MI    Detroit                        2      6 0.00000149 672662    0.333   0.401 0.236
## 10 Stout    MI    Detroit                       NA     NA 0.00000149 672662    0       0.194 0.173
## # ... with 15 more rows</code></pre>
<p>Which of the underserved cities have style percentages that are less than a standard deviation under the national percentage? From the chart below, we should prioritize in the following order: producing Ale in Kansas City and Detroit, “Other” in Sacremento, Kansas City and Nashville, IPA in Sacremento and Nashville,Lager in Memphis, Nashbille and Kansas City, Stout in all the 5 cities.</p>
<pre class="r"><code>ggplot(filterCity,aes(x=StyleCat)) + geom_point(aes(y=stylePct,col=City),size=3,position=position_jitter(width=0.2))+
   geom_point(aes(StyleCat,meanPct),size=1,data=stylePctByState)+geom_errorbar(aes(
  x=StyleCat,ymin= meanPct-sdPct,ymax=meanPct+sdPct
),data=stylePctByState)+ylab(&quot;Average Percentage of Style in a City&quot;)+
  xlab(&quot;Beer Style&quot;)+labs(title=&quot;Which Beer Style should we sell to which city?&quot;)</code></pre>
<p><img src="caseStudy1Missing_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>library(plotly) brewhist= ggplot(targetCities,aes(log(brewPcap),text=City)) + geom_histogram(bins=60) ggplotly(brewhist)</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
